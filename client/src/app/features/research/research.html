<div class="research container">
  <!-- Standard research page view -->
  @if (!showActivityView()) {
    <header class="research__header">
      <h1 class="research__title">Research Agent</h1>
      <p class="research__subtitle">
        Ask any question and get comprehensive research-backed answers
      </p>
    </header>

    <app-search-input
      [disabled]="researchService.isLoading()"
      (querySubmitted)="onQuerySubmitted($event)"
    ></app-search-input>

    <app-error-message
      [error]="researchService.error()"
      [canRetry]="!!researchService.currentQuery()"
      (retry)="onRetry()"
      (dismiss)="onDismissError()"
    ></app-error-message>

    <app-loading-indicator
      *ngIf="researchService.isLoading()"
      [currentStage]="1"
    ></app-loading-indicator>

    <!-- Research History Component - shows collapsible past queries -->
    @if (!researchService.isLoading()) {
      <div class="research__history-section">
        <app-research-history></app-research-history>
      </div>
    }
  }

  <!-- Agent activity view with answer (shown after research completes) -->
  @if (showActivityView() && currentLogId()) {
    <div class="research__activity-container">
      <!-- Activity view shows task breakdown and progress -->
      <app-agent-activity-view
        [logId]="currentLogId()!"
        (retry)="handleTaskRetry($event)"
      ></app-agent-activity-view>

      <!-- Answer section appears below activity -->
      @if (showAnswer()) {
        <div class="research__answer-section">
          <app-result-card
            [result]="researchService.currentResult()!"
          ></app-result-card>
        </div>
      }

      <!-- Back button to return to history -->
      <div class="research__actions">
        <button
          class="research__back-button"
          type="button"
          (click)="onBackToHistory()"
        >
          ‚Üê Back to History
        </button>
      </div>
    </div>
  }
</div>
